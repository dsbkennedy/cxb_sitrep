---
title: "Coxâ€™s Bazar Rohingya Camps - Epidemiological Summary"
output:
  word_document:
    fig_height: 3
    fig_width: 8
    reference_docx: epi_template.docx
  pdf_document: default
  html_document: default
params:
  organism:
    label: "Organism"
    input: text
    value: "COVID-19 (SARS-CoV-2)"
  response:
    label: "Response type"
    input: text
    value: "standard national"
---

```{r setup, include=FALSE}
<<<<<<< HEAD
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, error=FALSE)
=======

#knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, error=TRUE)
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

options(knitr.kable.NA = "Unknown")
```

```{r load libraries/functions, include=FALSE, message = FALSE}

<<<<<<< HEAD
pkgs <- c('tidyverse'	,'lubridate'	,'readxl'	,'epitrix'	,'dplyr'	,'kableExtra'	,'EpiCurve'	,'epitools'	,'flextable'	,'officer'	,'coarseDataTools'	,'janitor'	,'here'	,'googlesheets4'	,'purrr'	,'scales'	,'linelist'	,'tidyr'	,'plotrix'	,'tsibble'	,'tmap'	,'here'	,'purrr'	,'linelist'	,'ggthemes'	,'gt'	,'RcppRoll'	,'scales'	,'patchwork'	,'flexdashboard'	,'googlesheets4','table1'	,'ggpubr'	,'tmap'	,'htmltools'	,'magrittr'	,'mapproj'	,'sf'	,'ggplot2', 'glue')

pacman::p_load(pkgs, character.only = T)
=======
library(magrittr)
library(tidyverse)
library(lubridate)
library(readxl)
library(sf)
library(dplyr)
library(kableExtra)
library(EpiCurve)
library(epitools)
library(flextable)
library(officer)
library(coarseDataTools)
library(janitor)
library(here)
library(googlesheets4)
library(purrr)
library(scales)
library(linelist)
library(tidyr)
library(plotrix)
library(epitrix)
library(here)
library(purrr)
library(linelist)
library(ggthemes)
library(gt)
library(RcppRoll)
library(scales)
library(patchwork)
library(flexdashboard)
library(googlesheets4)
library(plotly)
library(httr)
library(jsonlite)
library(furrr)
library(table1)
library(ggpubr)
library(tmap)
library(htmltools)
library(mapproj)
library(ggplot2)
library(RColorBrewer)



source(here('modules', 'Login.R'))

# Manually load in the UNHCR data on population 
population<-read_excel("data/20200630_population_FDMN.xlsx")

#Define weeks
ThisWeek<- isoweek(today()) -1
LastWeek <- isoweek(today())-2


first_date_of_week <- function(year, week){
  strptime(paste(year, week, 1), format = "%Y %W %u")
}

append_date_suffix <- function(dates){
  dayy <- day(dates)
  suff <- case_when(dayy %in% c(11,12,13) ~ "th",
                    dayy %% 10 == 1 ~ 'st',
                    dayy %% 10 == 2 ~ 'nd',
                    dayy %% 10 == 3 ~'rd',
                    TRUE ~ "th")
  paste0(dayy, suff)
}

first_date <- ymd(first_date_of_week(2020,ThisWeek-1))
last_date <- ymd(first_date_of_week(2020,ThisWeek-1))+6

first_day <- append_date_suffix(first_date)
first_month <- month(first_date, label=TRUE, abbr=FALSE)

last_day <- append_date_suffix(last_date)
last_month <- month(last_date, label=TRUE, abbr=FALSE)

report_timeperiod <- sprintf("%s %s - %s %s", first_day, first_month, last_day, last_month)
# source(here('modules',"01 - CleaningScript2.R"))
# source(here('modules',"02 - FigureSetting_Summary.R"))
# source(here('modules',"03 - TestingAndPositivity.R"))
# source(here('modules',"04 - LastWeek.R"))
# source(here('modules', 'week_counts.R'))
source(here('master_file.R'))
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

source(here('code','modules', '0_setup.R'))
```

<<<<<<< HEAD
```{r Cleaning file, include=FALSE, message = FALSE}
# CLEANING
#source(here('code','modules',"01 - CleaningScript2.R"))
source(here('code','modules',"01_all.R"))
=======

::: {custom-style="subtitle"}
`r params$subtitle`
:::
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

::: {custom-style="centre"}
`r params$date`
:::

<<<<<<< HEAD
```{r, include=FALSE, message = FALSE}
# SETTTING NUMBERS FOR THE SUMMARY
#source(here('code','modules',"02 - FigureSetting_Summary.R"))
```

```{r, include=FALSE, message = FALSE}

#Testing and positivity
#source(here('code','modules',"03 - TestingAndPositivity.R"))

```

::: {custom-style="subtitle"}
`r params$subtitle`
:::

::: {custom-style="centre"}
`r params$date`
:::

```{r ageandsexsummary, echo=FALSE, warning=FALSE, message=FALSE}
#source(here('code','modules',"04 - LastWeek.R"))
#source(here('code','modules', 'week_counts.R'))
#source(here('code','modules',"05 - Maps.R"))

#source(here('code','modules', '99_moved_code.R'))
=======
```{r ageandsexsummary, echo=FALSE, warning=FALSE, message=FALSE}


```

# Introduction

This situation report covers the surveillance of **`r params$organism`** in Cox's Bazar Refugee Camps, Bangladesh.

-   This report was run on **`r format(Sys.time(), '%d %B, %Y')`**.
-   **The data in this reports covers the Forcibly Displaced Myanmar Nationals (FDMN)/Rohingya Refugee population ONLY**.
-   FDMN data are from the Cox's Bazar - IEDCR Field Lab.
-   Data for the Host community & for all of Bangladesh are in the Appendix.

# Executive summary

-   As of **(week `r ThisWeek`) (`r report_timeperiod`)** there are **`r total_cases`** confirmed cases of `r params$organism`.

-   This week (week `r ThisWeek`), there have been **`r cases_week[2]`** confirmed cases.

-   As of this week (week `r ThisWeek`), **`r CampsWithCases`**/34 camps have confirmed cases.

-   As of this week (week `r ThisWeek`), there have been a total of **`r deathscount` deaths** from COVID-19.

-   As of this week (week `r ThisWeek`), the incidence is **`r AR100k` per 100,000** people.

-   As of this week (week `r ThisWeek`), the overall positivity of all samples tested in FDMN/Rohingya Refugees was **`r FDMNOverallPosNum`%**.

-   This week (week `r ThisWeek`), **`r camp_test_fortnight %>% filter(week==ThisWeek) %>%  pull(total_tests)`** samples were tested. The test positivity was **`r camp_test_fortnight %>% filter(week==ThisWeek) %>%  pull(positivity)`**.

```{r, fig.cap="Figure 1: Confirmed cases by week (FDMN/ Rohingya Refugees)", message = FALSE}
# Epicurve - overall 

# FDMN_Only$count <- 1
# 
# summary_week <- as.data.frame(aggregate(FDMN_Only$count, by = list(FDMN_Only$Week), FUN =sum))
#min_week <- min(summary_week$Group.1)

summary_week <- fdmn_clean %>% count(week)


Epicurve<-
  ggplot(summary_week, aes(x=week, y=n)) +
  geom_col(position="stack", fill = "#ED7D31") +
  theme_minimal() +
  theme(panel.grid.minor=element_blank(), panel.grid.major=element_blank()) +
  theme(axis.text.x = element_text(angle = 90)) +
  theme(axis.text=element_text(size=8),
        axis.title=element_text(size=8,face="bold")) + 
  labs(x = "Week", y = "Number of cases") +
  scale_fill_manual(values=c("#4472C4")) +
  #coord_cartesian(xlim = c(min_week, ThisWeek))  +
      scale_x_continuous(breaks=breaks_pretty(n = 8)) +
  #scale_x_continuous(limits = c(min_week, ThisWeek)) %>% 
  #scale_x_continuous(limits=c(min_week, ThisWeek)) %>% 
 # ggtitle("Figure 1: Confirmed cases by specimen collection week (FDMN/ Rohingya Refugees)") + 
  theme(plot.title = element_text(size=10))
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

```

```{r, child=c(here::here("code","rmds","1_introduction.Rmd"), here::here("code","rmds","2_exec_summary.Rmd"))}
```

# Summary of cases - week `r LastWeek` and week `r ThisWeek`

<<<<<<< HEAD
-   There have been **`r cases_week_camp %>% filter(week==ThisWeek) %>% ungroup() %>%  summarise(cases=sum(cases,na.rm=TRUE)) %>% pull(cases)`** new cases in the FDMN/Rohingya Refugee population in week `r ThisWeek`. In week `r LastWeek` there were **`r cases_week_camp %>% filter(week==LastWeek) %>% ungroup() %>%  summarise(cases=sum(cases,na.rm=TRUE)) %>% pull(cases)`** cases.

## Age of cases

-   The median age of the cases this week (week `r ThisWeek`) was `r MedianAgeThisWeek` years old.
-   The median age of the cases last week (week `r LastWeek`) was `r MedianAgeLastWeek` years old.

## Sex breakdown

-   This week (week `r ThisWeek`) there were **`r ThisWeekMale`** male (`r Male_Prop_ThisWeek`%) and **`r ThisWeekFemale`** female (`r Female_Prop_ThisWeek`%) cases.
-   Last week (week `r LastWeek`) there were **`r LastWeekMale`** male (`r Male_Prop_Week`%) and **`r LastWeekFemale`** female (`r Female_Prop_Week`%) cases.
=======
-   There have been **`r cases_week[2]`** new cases in the FDMN/Rohingya Refugee population in week `r ThisWeek`. In week `r LastWeek` there were **`r cases_week[1]`** cases.

## Age of cases

-   The median age of the cases this week (week `r ThisWeek`) was `r MedianAgeThisWeek` years old.
-   The median age of the cases last week (week `r LastWeek`) was `r MedianAgeLastWeek` years old.

## Sex breakdown

-   This week (week `r ThisWeek`) there were **`r ThisWeekMale`** male (`r Male_Prop_ThisWeek`%) and **`r ThisWeekFemale`** female (`r Female_Prop_ThisWeek`%) cases.
-   Last week (week `r LastWeek`) there were **`r LastWeekMale`** male (`r Male_Prop_Week`%) and **`r LastWeekFemale`** female (`r Female_Prop_Week`%) cases.

## Location of cases

-   The following camps reported cases in week `r LastWeek` or `r ThisWeek`
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

## Location of cases

<<<<<<< HEAD
-   The following camps reported cases in week `r LastWeek` or `r ThisWeek`

=======
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
```{r}
cases_tests_table
```

## Testing - week `r LastWeek` & `r ThisWeek`

<<<<<<< HEAD
-   This week (week `r ThisWeek`), **`r camp_test_fortnight %>% filter(week==ThisWeek) %>%  pull(total_tests)`** samples were tested. Last week (week `r LastWeek`), **`r camp_test_fortnight %>% filter(week==LastWeek) %>%  pull(total_tests)`** samples were tested.

-   This week (week `r ThisWeek`), **`r camp_test_fortnight %>% filter(week==ThisWeek) %>%  pull(positivity)`** of samples were positive for COVID-19. Last week (week `r LastWeek`), **`r camp_test_fortnight %>% filter(week==LastWeek) %>%  pull(positivity)`** of samples were positive for COVID-19.

# Descriptive epidemiology - FDMN/Rohingya refugee cases

-   The first test in the FDMN/Rohingya population was on `r first_test_fdmn_day_month` (Week `r first_test_fdmn_week`).
-   The first confirmed case in the FDMN/Rohingya population was on `r first_case_fdmn_day_month` (Week `r first_case_fdmn_week`).

## Age and sex breakdown

-   The overall median age of cases is **`r medianage`** (range **`r RangeLow` - `r RangeUpper`** years old).
-   There have been **`r Male`** (`r Male_Prop`%) male cases and **`r Female`** (`r Female_Prop`%) female cases.

<br> <br>
=======
-   This week (week `r ThisWeek`), **`r camp_test_fortnight %>% filter(week==ThisWeek) %>%  pull(total_tests)`** samples were tested.Last week (week `r LastWeek`), **`r camp_test_fortnight %>% filter(week==LastWeek) %>%  pull(total_tests)`** samples were tested.

-   This week (week `r ThisWeek`), **`r camp_test_fortnight %>% filter(week==ThisWeek) %>%  pull(positivity)`** samples were positive for COVID-19.Last week (week `r LastWeek`), **`r camp_test_fortnight %>% filter(week==LastWeek) %>%  pull(positivity)`** samples were positive for COVID-19.

# Descriptive epidemiology - FDMN/Rohingya refugee cases

## Age and sex breakdown

-   The overall median age of cases is **`r medianage`** (range **`r RangeLow` - `r RangeUpper`** years old).
-   In total, there have been **`r Male`** (`r Male_Prop`%) male cases and **`r Female`** (`r Female_Prop`%) female cases.

<br> <br>

```{r, fig.cap="Figure 2: Confirmed cases by week and sex (FDMN/ Rohingya Refugees)"}

summary_Sex <- fdmn_clean %>% 
  count(week, sex) %>% 
  mutate(sex=case_when(sex=='m' ~ 'Male',
                       sex=='f' ~ 'Female'))

EpicurveSex<-
  ggplot(summary_Sex, aes(x=week, y=n, fill=sex)) +
  geom_col() +
  theme_minimal() +
  theme(panel.grid.minor=element_blank(), panel.grid.major=element_blank()) +
  theme(axis.text.x = element_text(angle = 90)) +
  theme(axis.text=element_text(size=8),
        axis.title=element_text(size=8,face="bold")) + 
  scale_fill_brewer(palette="Dark2", direction=-1) +
  scale_x_continuous(breaks=breaks_pretty(n = 8)) +
  labs(x = "Week", y = "Number of cases", fill='') +
  theme(plot.title = element_text(size=10))
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

```{r, fig.cap="Figure 2: Confirmed cases by week and sex (FDMN/ Rohingya Refugees)"}
EpicurveSex
```

<br> <br>

### Age and sex pyramid - confirmed cases FDMN/Rohingya refugee

```{r ageandsexplot, fig.cap="Figure 3: Confirmed cases by age group and sex (FDMN/ Rohingya Refugees)", echo=FALSE, warning=FALSE, message=FALSE}
<<<<<<< HEAD
=======

FDMN_df <- fdmn_clean %>%  mutate(sex=case_when(sex=='m' ~ 'Male',
                                                   sex=='f' ~ 'Female')) %>% 
    mutate(age_grp=cut(age_in_years, breaks=c(-Inf,18,59, +Inf), 
                       labels=c('Under 18', '18 to 59' ,'60 and over')))

AgeSex <-    ggplot(FDMN_df,aes(x=age_grp, fill=sex)) +
    geom_bar(data=subset(FDMN_df,sex=="Female"), color="white", width=1) +
    geom_bar(data=subset(FDMN_df,sex=="Male"), aes(y=..count..*(-1)), color="white", width=1) +
    theme_minimal() +
    labs(x='Age group', y='Number of cases') +
    scale_y_continuous(breaks=seq(-60,60,10),labels=abs(seq(-60,60,10))) +
    #scale_x_discrete(limits=levels(.$agerp)) +
    geom_hline(yintercept=0) +
    scale_fill_brewer(palette="Dark2", direction=-1) +
    coord_flip() +
    theme(panel.grid.minor=element_blank(), panel.grid.major=element_blank(), legend.title=element_blank())
  

>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
AgeSex
```

### Cases per 100,000 by age group

```{r}
<<<<<<< HEAD
=======
population_agegrp <- readxl::read_xlsx(here('data','block_population.xlsx'), sheet='Final', skip=1) %>% 
  clean_names %>%  
  clean_data() %>% 
  filter(grepl('total', camp)) %>% 
  filter(!camp=='grand_total') %>% 
  select(-block) %>% 
  mutate(across(c(infant_below_1:x16), as.numeric)) %>% 
  mutate(age_0_18 = rowSums(.[4:11])) %>% 
  mutate(age_18_59 = rowSums(.[12:13])) %>% 
  mutate(age_over60 = rowSums(.[14:15])) %>% 
  select(camp, contains('total'), contains('age')) %>% 
  mutate(camp=gsub('_total', '', camp)) %>% 
  mutate(camp=gsub('camp_', '', camp)) %>% 
  mutate(camp=trimws(camp))  %>% 
  select(camp, contains('age')) %>% 
  summarise(age_0_18=sum(age_0_18,na.rm=TRUE),
            age_18_59=sum(age_18_59,na.rm=TRUE),
            age_over60=sum(age_over60,na.rm=TRUE)) %>% 
  mutate(dummy=1) %>% 
  pivot_longer(-dummy) %>% 
  mutate(age_grp=case_when(name=='age_0_18' ~ 'Under 18',
                        name=='age_18_59' ~ '18 to 59',
                        name=='age_over60' ~ '60 and over')) %>% 
  select(-c(dummy,name))

cases_agegrp <- fdmn_clean %>% 
  mutate(age_grp=cut(age_in_years, breaks=c(-Inf,18,59, +Inf), labels=c('Under 18', '18 to 59' ,'60 and over'))) %>% 
  mutate(week=isoweek(date_of_case_detection)) %>% 
  count(week,age_grp, .drop=FALSE) %>% 
  left_join(population_agegrp, by='age_grp') %>% 
  mutate(per_capita=(n/value)*100000) %>% 
  mutate(age_grp=factor(age_grp, levels=c('Under 18', '18 to 59', '60 and over'))) %>% 
  ggplot(., aes(x=week,y=per_capita, fill=age_grp)) +
  geom_col(width = 0.5) +
  theme_minimal() +
      scale_fill_brewer(palette="Dark2", direction=-1) +
  #scale_x_continuous(breaks=breaks_pretty(n = 8), expand = c(.1, .7)) +
  #scale_x_date(expand = c(.1, .1)) +
  labs(x="Week", y="Cases 100,000 people", fill='Age group') +
  scale_y_continuous(breaks=breaks_pretty(n = 5)) +
  scale_x_continuous(breaks=breaks_pretty(n = 12))

>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
cases_agegrp

```

## Severity of reported cases at presentation

<br>

```{r, fig.cap="Table 2: Cases by severity of disease at presentation (FDMN/ Rohingya Refugees)"}
<<<<<<< HEAD

case_severity
=======
Summary_Severity<- fdmn_clean %>%
  # mutate(severity_of_disease=factor(severity_of_disease, levels=c('Critical', 'Severe', 'Mild/Moderate', 'Asymptomatic', 'Missing'))) %>% 
  group_by(severity_of_disease) %>%
  summarise(count=n()) %>% 
  ungroup() %>% 
    adorn_totals(where=c('row')) %>% 
  adorn_percentages("col") %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns() 
  #mutate(prop=(round(count/sum(count),3)*100)) %>% 
    adorn_totals("row") %>% 
    adorn_percentages("col") 



Table1<-flextable(Summary_Severity) %>%
set_header_labels(severity_of_disease = "Severity of Disease",
                  count = "Frequency",
                  prop = "Percentage of total (%)") %>% 
bold(bold = TRUE, part = "header") %>% 
  autofit() %>% 
  fontsize(., size = 10, part="all") 

Table1 %>% 
    add_header_lines(., values = "Table 2: Cases by severity of disease at presentation")

>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
```

<br>

<br>

```{r, fig.cap="Figure 4: Case severity at presentation by week (FDMN/ Rohingya Refugees)"}
<<<<<<< HEAD
=======
# Epidemic curve by severity

# summary_severity <- as.data.frame(aggregate(FDMN_Only$count, by = list(FDMN_Only$Week, FDMN_Only$severity_of_disease), FUN =sum))

SeverityEpicurve<-
  fdmn_clean %>% 
  count(week, severity_of_disease) %>% 
  ggplot(., aes(x=week, y=n, 
                fill=severity_of_disease)) +
  geom_col(position="stack") +
  theme_minimal() +
  scale_fill_brewer(palette="Dark2") +
  #scale_fill_manual(values=c("yellow", "red", "forest green", "dark orange", "dark grey")) +
  theme(panel.grid.minor=element_blank(), panel.grid.major=element_blank()) +
  theme(axis.text.x = element_text(angle = 90)) +
  theme(axis.text=element_text(size=8),
        axis.title=element_text(size=8,face="bold")) +
  theme(legend.position = 'top') +
  scale_x_continuous(breaks=breaks_pretty(n = 8)) +
  labs(x = "Week", y = "Number of cases", fill='Severity of disease at presentation') 

>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
SeverityEpicurve
```

<br>
<<<<<<< HEAD

## Outcomes at 30 days

As of Week **`r ThisWeek`** there have been **`r deathscount`** deaths in the FDMN/Rohingya Refugee population from COVID-19.

<br> <br>

```{r}
severity_outcome

```

<br> <br>

## Location of cases and cases per 100,000

-   As of this week (week `r ThisWeek`), **`r CampsWithCases`**/34 camps have confirmed cases.The number of cases per 100,000 people for each camp is displayed on a map in the Appendix.

# Testing

## Positivity
=======

## Outcomes at 30 days

As of Week **`r ThisWeek`** there have been a total of **`r deathscount`** deaths in the FDMN/Rohingya Refugee population from COVID-19.

<br> <br>

```{r}

Sum_tab_Severity <- fdmn_clean %>%
  tabyl(severity_of_disease,x30_day_outcome) %>%
  #summarise(count=n()) %>% 
  ungroup() %>% 
  adorn_totals(where=c('row','col')) %>% 
  adorn_percentages("col") %>%
  adorn_pct_formatting(digits = 1) %>%
  adorn_ns() 

Sum_tab_Severity2<-flextable(Sum_tab_Severity) %>% 
  autofit(.) %>% 
  fontsize(., size = 10, part="all") %>% 
  bold(bold = TRUE, part = "header")



# DeathsAsymp<-Sum_tab_Severity[1,2]
# DeatsCritical <-Sum_tab_Severity[2,2]
# DeathsSevere<-Sum_tab_Severity[4,2]
# DeathsMildModerate	<-Sum_tab_Severity[3,2]
# DeathsUnknown<-Sum_tab_Severity[5,2]

Sum_tab_Severity2  %>% 
      add_header_lines(., values = "Table 3: Cases by severity of disease at presentation & 30-day outcome")

```

<br> <br>

## Location of cases and cases per 100,000

-   As of this week (week `r ThisWeek`), **`r CampsWithCases`**/34 camps have confirmed cases.The number of cases per 100,000 people for each camp is displayed on a map in the Appendix.


```{r Map}
#source(here('modules',"05 - Maps.R"))

cases_map <-   Map_Rates100kData %>% 
    filter(!camp_key=='choukhali') %>% 
  tm_shape() +
  tm_polygons("rateper100k", title="Cases per 100,000", palette="YlGn") +
  tm_facets(by="upazila_upd", nrow=2) +
  tm_text("camp_key", fontface = "bold") +
  tm_borders()
  
tests_map <- Map_Tests100kData %>% 
      filter(!camp_key=='choukhali') %>% 
  tm_shape() +
  tm_polygons("testsper100k", title="Tests per 100,000", palette="BuPu",textNA = "No reported tests") +
  tm_facets(by="upazila_upd", nrow=2) +
  tm_text("camp_key",  fontface = "bold") +
  tm_borders()

```

# Testing

```{r,warnings=FALSE}


# Graph for testing the FDMN population

FDMN_Test_graph<-test_nationality %>% 
  filter(name %in% c('fdmn', 'fdmn_positive')) %>% 
  mutate(week=isoweek(date_format)) %>% 
  filter(week<=ThisWeek) %>% 
  select(week,name,value) %>% 
  group_by(week,name) %>% 
  summarise(value=sum(value,na.rm=TRUE)) %>% 
  mutate(name_fac=factor(name, levels = c('fdmn', 'fdmn_positive'),
                         labels=c('Tests', 'Cases'))) %>% 
  ggplot(., aes(x=week, y=value, fill=name_fac)) +
  geom_bar(stat="identity") +
      scale_fill_manual(values=c("#ED7D31","#4472C4")) +
      scale_x_continuous(breaks=breaks_pretty(n = 8)) +
  # scale_x_date(date_breaks= '30 day', date_minor_breaks = '7 day',
  #              date_labels = '%d-%m') +
  labs(caption = "Data source: Coxâ€™s Bazar - IEDCR Field Lab",
       x="Week",
       y= "Number",
       fill="") +
  theme_minimal()



```

## Positivity

```{r, include=FALSE}
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

-   Between Week **`r first_test_fdmn_week`** & Week **`r ThisWeek`**, **`r FDMN_Test`** samples have been tested from the FDMN/Rohingya Refugee population since.

<<<<<<< HEAD
=======
#Making a % positive
FDMNPos<- testing_clean[, c(1,4,5)]
FDMNPos$Positivity<-round(FDMNPos$fdmn_positive/FDMNPos$fdmn*100, 1)

FDMNOverallPos<- FDMNPos %>%
  summarise(total_tests = sum(fdmn, na.rm=TRUE),
             total_cases = sum(fdmn_positive, na.rm=TRUE)) %>%
              mutate(Overall_Pos = round(as.numeric(total_cases/total_tests*100), 1))

FDMNOverallPosNum<-FDMNOverallPos$Overall_Pos

FDMNPos$date<-as.Date(FDMNPos$date)

```

-   Between Week **`r first_test_fdmn_week`** & Week **`r ThisWeek`**, **`r FDMN_Test`** samples have been tested from the FDMN/Rohingya Refugee population since.

>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
-   `r n_cases_FDMN` **(`r FDMNOverallPosNum`)%** samples have been positive for COVID-19.

<br>

```{r, fig.cap="Figure 5: Tests and cases by week"}

FDMN_Test_graph
```

<br>

## Age of samples tested

-   Overall, the median age of samples tested is `r tests_age_overall$median` years old.
-   This week (week `r ThisWeek`) the median age of samples tested was `r tests_age_thisweek$median` years old.
-   Last week (week `r LastWeek`) the median age of samples tested was `r tests_age_lastweek$median` years old.

```{r tests_by age , fig.cap="Figure 6: Age of samples tested by week"}

tests_age_gph
<<<<<<< HEAD
```

## Location of tests
=======
```

## Location of tests

The number of tests per 100,000 people for each camp is displayed on a map in the Appendix.

\newpage

# Further information

## Case definitions

### Suspected COVID-19

A. Person who meets the clinical AND epidemiological criteria:

-   Clinical criteria:

    Acute onset of fever AND cough; OR,

    Acute onset of ANY THREE OR MORE of the following signs or symptoms:

    -   fever,cough

    -   general weakness/fatigue

    -   headache

    -   myalgia

    -   sore throat

    -   coryza

    -   dyspnoea

    -   anorexia/nausea/vomiting

    -   diarrhoea

    -   altered mental status.

-   Epidemiological criteria

    -   Residing (or working) in an area with high risk of transmission of the virus: for example, closed residential settings and humanitarian settings, such as camp and camp-like settings for displaced persons, any time within the 14 days prior to symptom onset;

        OR,

    -   Residing in or travel to an area with community transmission anytime within the 14 days prior to symptom onset;

        OR,

    -   Working in health setting, including within health facilities and within households, anytime within the 14 days prior to symptom onset.

B. A patient with severe acute respiratory illness (SARI: acute respiratory infection with history of fever or measured fever of â‰¥ 38 CÂ°; and cough; with onset within the last 10 days; and who requires hospitalization)

### Probable COVID-19

Definition A: A patient who meets clinical criteria above AND is a contact of a probable or confirmed case, or epidemiologically linked to a cluster of cases which has had at least one confirmed case identified within that cluster.

Definition B: A suspected case (described above) with chest imaging showing findings suggestive of COVID-19 disease.

Definition C: A person with recent onset of anosmia (loss of smell) or ageusia (loss of taste)in the absence of any other identified cause.

Definition D: Death, not otherwise explained, in an adult with respiratory distress preceding death AND who was a contact of a probable or confirmed case or epidemiologically linked to a cluster which has had at least one confirmed case identified within that cluster.

### Confirmed COVID-19

A person with laboratory confirmation of COVID-19 infection, irrespective of clinical signs and symptoms.

\newpage

#### Appendix 1 - Tests & cases in Cox's Bazar host population

```{r}

Host_Test_graph <- test_nationality %>% 
  filter(name %in% c('host', 'host_positive')) %>% 
  mutate(week=isoweek(date_format)) %>% 
  select(week,name,value) %>% 
  filter(week<=ThisWeek) %>% 
  group_by(week,name) %>% 
  summarise(value=sum(value,na.rm=TRUE)) %>% 
  mutate(name_fac=factor(name, levels = c('host', 'host_positive'),
                         labels=c('Tests', 'Cases'))) %>% 
  ggplot(., aes(x=week, y=value, fill=name_fac)) +
  geom_bar(stat="identity") +
    scale_fill_manual(values=c("#ED7D31","#4472C4")) +
      scale_x_continuous(breaks=breaks_pretty(n = 8)) +
 # scale_x_continuous(limits=c(10,ThisWeek)) +
  # scale_x_date(date_breaks= '30 day', date_minor_breaks = '7 day',
  #              date_labels = '%d-%m') +
  labs(caption = "Data source: Coxâ€™s Bazar - IEDCR Field Lab",
       x="Week",
       y= "Number",
       fill="") +
  theme_minimal()

Host_Test_graph
```

#### Appendix 2 - Tests & cases in Bangladesh

```{r}
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e

The number of tests per 100,000 people for each camp is displayed on a map in the Appendix.

\newpage

<<<<<<< HEAD
```{r, child=c(here::here("code","rmds","6_further_info.Rmd"))}
=======
#### Appendix 3 - Cases per 100,000 by household location

```{r, fig.height=10}
cases_map
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e
```

\newpage

<<<<<<< HEAD
```{r, child=c(here::here("code","rmds","7_appendix.Rmd"))}
```
=======
#### Appendix 4 - Tests per 100,000 by household location
>>>>>>> e577dec3173b0f632ab79191466c5d6c183c850e


